<div class="container-fluid py-3">
  <ng-container *ngIf="!currentStep">
    <ngb-alert [dismissible]="false" class="d-block mt-3" type="info">
      Click on the button below to start a new pooling of samples. The complete process will only get saved to the database at the very end!
    </ngb-alert>

    <button class="btn btn-primary mt-3" (click)="start()">Start</button>
    <button class="btn btn-outline-secondary mt-3 ms-2" routerLink="/">Home</button>
  </ng-container>




  <ng-container *ngIf="currentStep === 'identify-pool'">
    <ngb-alert [dismissible]="false" class="d-block mt-3" type="info">
      Provide the identifier of the pool.
    </ngb-alert>

    <div class="border rounded bg-light p-3">
      <div class="btn-group btn-group-toggle mb-3" ngbRadioGroup name="pool-input-mode" [(ngModel)]="poolInputMode" (change)="changeInputMode($event)">
        <label ngbButtonLabel class="btn-primary">
          <input ngbButton type="radio" value="camera"> Camera
        </label>
        <label ngbButtonLabel class="btn-primary">
          <input ngbButton type="radio" value="scanner"> Scanner
        </label>
        <label ngbButtonLabel class="btn-primary">
          <input ngbButton type="radio" value="manual"> Manual
        </label>
      </div>

      <div *ngIf="poolInputMode === 'manual'">
        <div class="form-group">
          <label for="pool-id">Pool ID</label>
          <input type="text" class="form-control" id="pool-id" placeholder="Pool ID" [(ngModel)]="poolId">
        </div>
        <button class="btn btn-primary mt-3" (click)="checkPool(poolId ||'')" [disabled]="!poolId">Continue</button>
      </div>

      <div *ngIf="poolInputMode === 'camera'" style="width: 200px">
        <zxing-scanner
          (scanSuccess)="poolScanSuccessHandler($event)"
          (scanError)="scanErrorHandler($event)"
        ></zxing-scanner>
      </div>

      <div *ngIf="poolInputMode === 'scanner'">
        <span class="text-muted">Please scan the QR Code …</span>
      </div>
    </div>
  </ng-container>




  <ng-container *ngIf="currentStep === 'scan-samples'">
    <ngb-alert [dismissible]="false" class="d-block mt-3" type="info">
      Start scanning the QR codes on the samples. You can select the camera or a hardware scanner. You must at least scan '1' sample per pool ({{ poolId }}).
    </ngb-alert>

    <div class="border rounded bg-light p-3">
      <div class="btn-group btn-group-toggle mb-3" ngbRadioGroup name="sample-input-mode" [(ngModel)]="sampleInputMode" (change)="changeInputMode($event)">
        <label ngbButtonLabel class="btn-primary">
          <input ngbButton type="radio" value="camera"> Camera
        </label>
        <label ngbButtonLabel class="btn-primary">
          <input ngbButton type="radio" value="scanner"> Scanner
        </label>
        <label ngbButtonLabel class="btn-primary">
          <input ngbButton type="radio" value="manual"> Manual
        </label>
      </div>

      <div *ngIf="sampleInputMode === 'manual'">
        <div class="form-group">
          <label for="next-sample-id">Next Sample ID</label>
          <input type="text" class="form-control" id="next-p-id" placeholder="Next Sample ID" [(ngModel)]="nextSampleId">
          <button class="btn btn-outline-primary mt-3" (click)="manualNextSampleId(nextSampleId)" [disabled]="!nextSampleId">Confirm</button>
        </div>
      </div>

      <div *ngIf="sampleInputMode === 'camera'" style="width: 200px">
        <zxing-scanner
          (scanSuccess)="sampleScanSuccessHandler($event)"
          (scanError)="scanErrorHandler($event)"
        ></zxing-scanner>
      </div>

      <div *ngIf="sampleInputMode === 'scanner'">
        <span class="text-muted">Please scan the QR Code …</span>
      </div>
    </div>

    <button class="btn btn-primary mt-3" (click)="done()" [disabled]="addedSamples.length === 0">Done</button>
  </ng-container>

  <ng-container *ngIf="currentStep === 'done'">
    <ngb-alert [dismissible]="false" class="d-block mt-3" type="info">
      By confirm with the button below, this pooling of the samples get registered in the database is are ready for the next step.
    </ngb-alert>

    <button class="btn btn-primary mt-3" (click)="upload()">Upload to database</button>

  </ng-container>


  <hr>

  <div class="container">
    <div *ngIf="poolId">
      <span>Pool ID: </span><code>{{ poolId }}</code>
    </div>
    <div *ngIf="addedSamples.length > 0" class="mt-2">
      <div class="text-muted">Added Samples</div>
      <ul class="list-group">
        <li *ngFor="let el of addedSamples.reverse()" class="list-group-item d-flex align-items-center px-1 py-0 small">
          <span>{{ el.sample_id }}</span>
        </li>
      </ul>
    </div>
  </div>

  <div *ngIf="poolId" class="container pt-4">
    <div class="form-group">
      <label for="pooling-source">Source (optional)</label>
      <input type="text" class="form-control" id="pooling-source" placeholder="Source" [(ngModel)]="source">
    </div>
    <div class="form-group">
      <label for="pooling-comment">Comment (optional)</label>
      <textarea rows="4" class="form-control" id="pooling-comment" placeholder="Add your comment here …" [(ngModel)]="comment"></textarea>
    </div>
  </div>
</div>
